<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Razka Bintang Firdaus</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <style>
        /* Definisi Warna dan Gaya Kustom */
        /* Menggantikan fungsi Tailwind yang dihapus */
        .bg-dark { background-color: #111827; }
        .bg-card-dark { background-color: #1f2937; }
        .text-primary-pink { color: #F7668F; }
        .border-primary-pink { border-color: #F7668F; }
        .shadow-pink-glow { box-shadow: 0 0 15px rgba(247, 102, 143, 0.4); }
        .text-secondary-lilac { color: #C084FC; }
        .border-secondary-lilac { border-color: #C084FC; }
        .shadow-lilac-glow { box-shadow: 0 0 15px rgba(192, 132, 252, 0.4); }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Background Super Gelap */
            color: #e5e7eb;
            line-height: 1.6;
            /* Tambahkan kelas Tailwind yang sering dipakai secara manual */
            padding: 1rem; /* p-4 */
            max-width: 28rem; /* max-w-md */
            margin-left: auto; /* mx-auto */
            margin-right: auto; /* mx-auto */
            padding-bottom: 4rem; /* pb-16 */
            min-height: 100vh; /* min-h-screen */
        }
        
        /* Tambahan styling untuk memastikan tampilan tetap rapi */
        .flex-center-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* Styling untuk scrollbar custom (horizontal di mobile) */
        .vibe-scroll::-webkit-scrollbar {
            height: 3px;
        }
        .vibe-scroll::-webkit-scrollbar-thumb {
            background-color: #F7668F;
            border-radius: 2px;
        }
        
        /* Animasi loading */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body id="app-body">

    <div id="app-container" class="p-4 w-full max-w-md mx-auto pb-16 min-h-screen">
        <div class="flex-center-screen">
            <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-t-4 border-primary-pink"></div>
            <p class="ml-4 text-secondary-lilac text-lg">Loading Vibe...</p>
        </div>
    </div>

    <div id="edit-modal-container" class="hidden"></div>
    <div id="image-modal-container" class="hidden"></div>

    <script type="module">
        // Import modul Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variabel Global dari Lingkungan Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'github-link-in-bio';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- KONSTANTA & DEFAULT DATA ---
        const defaultProfile = {
            name: 'Razka Bintang Firdaus',
            // SINTAKS SUDAH BENAR
            bio: "AI Addict | 05' | ENFP", 
            // GANTI LINK FOTO DENGAN PLACEHOLDER YANG PASTI BEKERJA
            profilePicUrl: 'https://placehold.co/128x128/f7668f/1f2937?text=RAZKA', 
            spotifyUrl: 'https://open.spotify.com/track/54mnwt3kO0uYsy0ceg14JP?si=WlJNWu66RE2H9dIctnOnfw',
            vibes: {
                kpop: 'TWICE, aespa, Hearts2Hearts, LE SSERAFIM',
                motogp: 'Marc Marquez MM93 - #MoreThanANumber',
                football: 'Real Madrid ðŸ‘‘'
            },
        };

        // Definisi Kumpulan Foto untuk Setiap Vibe
        // GANTI SEMUA URL FOTO DENGAN PLACEHOLDER AGAR LOADING CEPAT
        const kpopImages = [
            { src: 'https://placehold.co/180x250/f7668f/1f2937?text=K-POP', alt: 'TWICE' }, 
            { src: 'https://placehold.co/180x250/f7668f/1f2937?text=AESPA', alt: 'AESPA' }, 
            { src: 'https://placehold.co/180x250/f7668f/1f2937?text=LE_S', alt: 'LE SSERAFIM' }, 
            { src: 'https://placehold.co/180x250/f7668f/1f2937?text=H2H', alt: 'Hearts2Hearts' }
        ];
        const motogpImages = [
            { src: 'https://placehold.co/300x400/c084fc/1f2937?text=MM93', alt: 'Marc Marquez' }
        ];
        const footballImages = [
            { src: 'https://placehold.co/300x400/f7668f/1f2937?text=RM', alt: 'Real Madrid' }
        ];


        // --- FIREBASE INSTANCES ---
        let app, db, auth;
        let userId = null;

        // --- PATH FIREBASE ---
        const PUBLIC_PATH = `artifacts/${appId}/public/data/profile_public/user_data`;
        const getPrivatePath = (uid) => `artifacts/${appId}/users/${uid}/profile/user_data`;

        // --- UTILITY FUNCTIONS ---
        const getSpotifyTrackId = (url) => {
            try {
                if (!url) return '';
                const urlObj = new URL(url);
                const pathSegments = urlObj.pathname.split('/');
                const trackIndex = pathSegments.indexOf('track');
                if (trackIndex !== -1 && pathSegments.length > trackIndex + 1) {
                    return pathSegments[trackIndex + 1].split('?')[0]; 
                }
                return '';
            } catch (error) {
                return '';
            }
        };

        const getSpotifyEmbedUrl = (trackUrl) => {
            const trackId = getSpotifyTrackId(trackUrl);
            return trackId ? `https://open.spotify.com/embed/track/${trackId}?utm_source=generator&theme=0` : '';
        };

        // --- INITIALIZATION ---
        const initializeAppAndAuth = async () => {
            if (!firebaseConfig) {
                console.warn("Firebase config tidak ditemukan. Menggunakan data default.");
                // Jika config tidak ada, langsung render dengan data default.
                renderApp(defaultProfile);
                return;
            }

            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (initialAuthToken) {
                    const userCredential = await signInWithCustomToken(auth, initialAuthToken);
                    userId = userCredential.user.uid;
                } else {
                    const userCredential = await signInAnonymously(auth);
                    userId = userCredential.user.uid;
                }
                console.log("Firebase Auth Success. User ID:", userId);
                
                listenToPublicProfile();

            } catch (e) {
                console.error("Firebase Initialization or Auth Error:", e);
                userId = auth?.currentUser?.uid || crypto.randomUUID();
                listenToPublicProfile();
            }
        };
        
        // --- FIREBASE LISTEN (READ) ---
        const listenToPublicProfile = () => {
            if (!db) {
                renderApp(defaultProfile, "Database tidak siap. Menampilkan data default.");
                return;
            }

            const profileDocRef = doc(db, PUBLIC_PATH);
            
            onSnapshot(profileDocRef, (docSnap) => {
                let profileData = defaultProfile;
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    profileData = {
                        ...defaultProfile, 
                        ...data,
                        vibes: { ...defaultProfile.vibes, ...data.vibes }
                    };
                }
                renderApp(profileData);
            }, (e) => {
                console.error("Firestore Listen Error:", e);
                renderApp(defaultProfile, "Gagal memuat data live. Menampilkan data default.");
            });
        }

        // --- FIREBASE WRITE (SAVE) ---
        window.saveProfile = async (newProfile) => {
            if (!db || !userId) {
                console.error("Database atau User ID tidak siap.");
                return;
            }

            const privateDocRef = doc(db, getPrivatePath(userId));
            const publicDocRef = doc(db, PUBLIC_PATH);

            try {
                await Promise.all([
                    setDoc(privateDocRef, newProfile, { merge: true }),
                    setDoc(publicDocRef, newProfile, { merge: true })
                ]);
                console.log("Profile saved successfully to both private and public paths.");
            } catch (e) {
                console.error("Error saving profile:", e);
            }
        };

        // --- UI RENDER FUNCTIONS ---
        const renderVibeItem = (emoji, title, content, color, onClickFn) => `
            <div 
                onclick="${onClickFn}"
                class="p-4 rounded-xl mb-3 border-l-4 border-${color} bg-gray-800/50 shadow-lg cursor-pointer transition transform hover:scale-[1.01] hover:bg-gray-700/50"
            >
                <div class="text-lg font-bold flex items-center text-${color}">
                    <span class="text-2xl mr-3">${emoji}</span>
                    ${title}
                </div>
                <p class="text-sm text-gray-300 mt-1 pl-8 overflow-hidden whitespace-nowrap overflow-x-auto vibe-scroll">${content}</p>
            </div>
        `;

        const renderPrimaryButton = (text, onClickFn, colorClass, hoverClass, shadowClass) => `
            <button
                onclick="${onClickFn}"
                class="w-full flex items-center justify-center p-4 rounded-
